let state=0;const offenseList=["Blades","Bludgeons","Unarmed","Throwing","Aim","Magic (Blasting)","Magic (Blighting)","Gadgetry (Destruction)","Gadgetry (Disruption)","Summon","presence"],defenseList=["Fortitude","Clarity","Armor","Parry","Swiftness","Magic","Gadgetry","Summon","Pilot","Stealth"],supportList=["Performance","Magic","Gadgetry","Medicine","Summon","Perception (Physical)","Perception (Magical)","Perception (Insight)","Provisions","Might","Sleight Of Hand"];let auxCount=30;var auxoff=0,auxdef=0,auxsup=0,offPoints=15;const offPointsBase=15,defPointsBase=15,supPointsBase=15;var defPoints=15,supPoints=15,auxPoints=30;let offPointMax=10,defPointMax=10,supPointMax=10,offComb=0,defComb=0,supComb=0;var offSkillID=[],defSkillID=[],supSkillID=[],auxDif=0;function engine(e){generateUI();let t=pullID("content"),l=pullID("offenseGrid"),a=pullID("defenseGrid"),n=pullID("supportGrid");pullID("sheet");proceduralUI(l,a,n,t),updateData(),$b(t,"Save Data",function(){save()},"button")}function generateUI(){$d(body,"","content");let e=pullID("content");$form(e,"","sheet");let t=pullID("sheet");$d(t,"","metaBox");let l=pullID("metaBox");$h(3,l,"Auxilary points: "+auxCount,"","auxCounter"),$d(l,"","charnameBox");let a=pullID("charnameBox");$input(a,"Name","sheetData","charName","text","sheetName","Character Name",""),$d(l,"","hpBox");let n=pullID("hpBox");$input(n,"HP","sheetData","charHP","text","sheetHP","HP","true"),$d(l,"","armorBox");let u=pullID("armorBox");$input(u,"Armor","sheetData","charArmor","text","sheetArm","Armor","true"),$hr(t,"",""),$d(t,"contentGrid","stats");let o=pullID("stats");$d(t,"contentGrid","charData");pullID("charData");$d(o,"subGrid","offenseGrid");let s=pullID("offenseGrid");$d(o,"subGrid","defenseGrid");let i=pullID("defenseGrid");$d(o,"subGrid","supportGrid");let r=pullID("supportGrid");$h(3,i,"Defense Points: "+defPoints,"pointCount","defPointCounter"),$h(3,s,"Offense Points: "+offPoints,"pointCount","offPointCounter"),$h(3,r,"Support Points: "+supPoints,"pointCount","supPointCounter"),$hr(t)}function proceduralUI(e,t,l,a){for(let t=0;t<offenseList.length;t++){console.log("A tick"),$d(e,"",offenseList[t]+"Div");let l=pullID(offenseList[t]+"Div");$p(l,offenseList[t],"",offenseList[t]+"Label"),$sel(l,"seler","selerOf"+t);let a=pullID("selerOf"+t);offSkillID.push("selerOf"+t);for(let e=0;e<=offPointMax;e++)$opt(a,e,"","");pullID("selerOf"+t).onchange=function(){update("off","selerOf"+t)},pullID("selerOf"+t).value=0}for(let e=0;e<defenseList.length;e++){console.log("B tick"),$d(t,"",defenseList[e]+"DefDiv");let l=pullID(defenseList[e]+"DefDiv");$p(l,defenseList[e],"",defenseList[e]+"Label"),$sel(l,"seler","selerDe"+e);let a=pullID("selerDe"+e);defSkillID.push("selerDe"+e);for(let e=0;e<=defPointMax;e++)$opt(a,e,"","");pullID("selerDe"+e).onchange=function(){update("def","selerDe"+e)},pullID("selerDe"+e).value=0}for(let e=0;e<supportList.length;e++){$d(l,"",supportList[e]+"SuDiv");let t=pullID(supportList[e]+"SuDiv");$p(t,supportList[e],"",supportList[e]+"Label"),$sel(t,"seler","selerSu"+e);let a=pullID("selerSu"+e);supSkillID.push("selerSu"+e),pullID("selerSu"+e).onchange=function(){update("sup","selerSu"+e)},pullID("selerSu"+e).value=0;for(let e=0;e<=supPointMax;e++)$opt(a,e,"","")}for(let e=0;e<supportList.length;e++)pullID("selerSu"+e).value=0;generate_charData()}let charDatList=["Title","Occupation","Rank","Feature","Knowledge","Technique","Special"],ranks=["Trash Panda","Ally","Initiate","Guardian","Vigilant","Archon","Grand Archon"];function generate_charData(){let e=pullID("charData");for(let t=0;t<charDatList.length;t++){if("Occupation"==charDatList[t]||"Feature"==charDatList[t]||"Knowledge"==charDatList[t]||"Technique"==charDatList[t]||"Special"==charDatList[t]){$d(e,"housing",charDatList[t]+"houseDiv");let l=pullID(charDatList[t]+"houseDiv");for(let e=0;e<3;e++){$d(l,"dataItem",charDatList[t]+e+"div");let a=pullID(charDatList[t]+e+"div");$area(a,"","input",charDatList[t]+e,charDatList[t]+" "+(e+1)+":")}}if("Rank"==charDatList[t]){$d(e,"dataItemTitle","rankDiv");let t=pullID("rankDiv");$p(t,"Rank: ","label"),$sel(t,"","rankSel");let l=pullID("rankSel");for(let e=0;e<ranks.length;e++)$opt(l,ranks[e]);l.value="Guardian"}if("Title"==charDatList[t]){$d(e,"dataItemTitle","charTitle");let t=pullID("charTitle");$input(t,"","input","Title","","","Title:")}}}function save(){let e=generateObject();try{localStorage.setItem("sheet"+localStorage.length,JSON.stringify(e)),alert("Saved successfully!")}catch{alert("Save failed! See console for error.")}}function load(e){null==e&&engine();let t=pullID("sheet");if(null==e){$sel(t,"","profileSelector");let e=pullID("profileSelector");for(let t=0;t<localStorage.length;t++){let l=JSON.parse(localStorage.getItem("sheet"+t));null!=l.name&&$opt(e,l.name,"")}e.onchange=function(){load(!0)}}let l,a=pullID("profileSelector");if(null==a)l=e;else for(let e=0;e<localStorage.length;e++){let t=JSON.parse(localStorage.getItem("sheet"+e));console.log(t),t.name==a.value&&(l=t)}loadState(l)}function loadState(e){let t=e.off,l=e.def,a=e.sup,n=(e.auxPoints,e.occupation),u=e.feature,o=e.technique,s=e.knowledge,i=e.special;if(null!=t){for(let e=0;e<t.length;e++)pullID("selerOf"+[e]).value=t[e];for(let e=0;e<l.length;e++)pullID("selerDe"+[e]).value=l[e];for(let e=0;e<a.length;e++)pullID("selerSu"+[e]).value=a[e];pullID("charName").value=e.name}for(let e=0;e<n.length;e++)pullID("Occupation"+e).value=n[e];for(let e=0;e<u.length;e++)pullID("Feature"+e).value=u[e];for(let e=0;e<o.length;e++)pullID("Technique"+e).value=o[e];for(let e=0;e<s.length;e++)pullID("Knowledge"+e).value=s[e];for(let e=0;e<i.length;e++)pullID("Special"+e).value=i[e];pullID("Title").value=e.title,pullID("rankSel").value=e.rank,update("off"),update("def"),update("sup")}function exportSheet(){let e=generateObject(),t=pullID("sheet");try{pullID("exportString").remove()}catch{}$p(t,JSON.stringify(e),"","exportString")}function importSheet(){let e=pullID("importBox").value;console.log(e),load(JSON.parse(e))}function generateObject(){var e={},t=[],l=[],a=[],n=[],u=[],o=[],s=[],i=[];e.name=pullID("charName").value,e.hp=pullID("charHP").value,e.armor=pullID("charArmor").value,e.title=pullID("Title").value,e.rank=pullID("rankSel").value;for(let e=0;e<offenseList.length;e++){let l=pullID("selerOf"+[e]).value;t.push(l)}for(let e=0;e<defenseList.length;e++){let t=pullID("selerDe"+[e]).value;l.push(t)}for(let e=0;e<supportList.length;e++){let t=pullID("selerSu"+[e]).value;a.push(t)}for(let e=0;e<3;e++){let t=pullID("Occupation"+e).value;n.push(t)}for(let e=0;e<3;e++){let t=pullID("Feature"+e).value;u.push(t)}for(let e=0;e<3;e++){let t=pullID("Technique"+e).value;o.push(t)}for(let e=0;e<3;e++){let t=pullID("Knowledge"+e).value;s.push(t)}for(let e=0;e<3;e++){let t=pullID("Special"+e).value;i.push(t)}return e.occupation=n,e.feature=u,e.technique=o,e.knowledge=s,e.special=i,e.off=t,e.def=l,e.sup=a,e.auxData=auxPoints,e}var num=0;function update(e){pullID("defPointCounter"),pullID("supPointCounter");"off"==e&&offPoints+auxPoints>0?updateAssist("off"):"def"==e&&defPoints+auxPoints>0?updateAssist("def"):"sup"==e&&supPoints+auxPoints>0&&updateAssist("sup"),updateData()}function updateData(){val("charHP",Math.floor(val("selerDe0")/2+5)),pullID("selerDe2").value<0?val("charArmor",0):val("charArmor",val("selerDe2"))}let updateAssist=type=>{var typePoints=eval(type+"Points"),num=0;let data=eval(type+"SkillID");var poinTexBase=eval(type+"PointCounter");for(let e=0;e<data.length;e++){let t=parseInt(pullID(data[e]).value);"off"==type&&(t<9?(console.log("works fine"),num+=t):9==t?num=num+t+1:10==t&&(num=num+t+4)),"def"==type&&(t<9?num+=t:9==t?num=num+t+1:10==t&&(num=num+t+4)),"sup"==type&&(t<9?num+=t:9==t?num=num+t+1:10==t&&(num=num+t+4))}let pBase=eval(type+"PointsBase"),pnum=pBase-num;if(pBase-num<0){"off"==type?auxoff=Math.abs(pnum):"def"==type?auxdef=Math.abs(pnum):"sup"==type&&(auxsup=Math.abs(pnum));let e=auxoff+auxdef+auxsup,t=auxCount-(e+-Math.abs(auxDif));auxPoints=t,typePoints=0,"off"==type?poinTexBase.innerText="Offense Points: "+typePoints:"def"==type?poinTexBase.innerText="Defense Points: "+typePoints:"sup"==type&&(poinTexBase.innerText="Support Points: "+typePoints),pullID("auxCounter").innerText="Auxilary points: "+auxPoints}else{"off"==type?auxoff=0:"def"==type?auxdef=0:"sup"==type&&(auxsup=0),typePoints=pBase-num,"off"==type?poinTexBase.innerText=typePoints>15?"Offense Points: 15":"Offense Points: "+typePoints:"def"==type?poinTexBase.innerText=typePoints>15?"Defense Points: 15":"Defense Points: "+typePoints:"sup"==type&&(poinTexBase.innerText=typePoints>15?"Support Points: 15":"Support Points: "+typePoints);let e=auxoff+auxdef+auxsup,t=auxCount-(e+-Math.abs(auxDif));auxPoints=t,pullID("auxCounter").innerText="Auxilary points: "+auxPoints}auxPoints<0&&(pullID("auxCounter").innerText="Auxilary points: ILLEGAL  ")};