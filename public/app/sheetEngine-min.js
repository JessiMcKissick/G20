let state=0;const offenseList=["Blades","Bludgeons","Unarmed","Throwing","Aim","Magic (Blasting)","Magic (Blighting)","Gadgetry (Destruction)","Gadgetry (Disruption)","Summon","Presence"],defenseList=["Fortitude","Clarity","Armor","Parry","Swiftness","Stealth","Magic","Gadgetry","Pilot","Summon"],supportList=["Might","Perception (Physical)","Perception (Magical)","Perception(Insight)","Sleight of Hand","Medicine","Magic","Gadgetry","Provisions","Summon","Performance"];let auxCount=30;var auxoff=0,auxdef=0,auxsup=0,offPoints=15;const offPointsBase=15,defPointsBase=15,supPointsBase=15;var defPoints=15,supPoints=15,auxPoints=30;let offPointMax=10,defPointMax=10,supPointMax=10,offComb=0,defComb=0,supComb=0;var offSkillID=[],defSkillID=[],supSkillID=[],auxDif=0;function engine(e){generateUI();let t=pullID("content"),l=pullID("offenseGrid"),a=pullID("defenseGrid"),u=pullID("supportGrid");pullID("sheet");proceduralUI(l,a,u,t),updateData(),$b(t,"Save Data",function(){save()},"button")}function generateUI(){$d(body,"","content");let e=pullID("content");$form(e,"","sheet");let t=pullID("sheet");$d(t,"","metaBox");let l=pullID("metaBox");$d(l,"","statBox");let a=pullID("statBox");$d(a,"","charnameBox");let u=pullID("charnameBox");$input(u,"Name","sheetData","charName","text","sheetName","Character Name",""),$d(a,"","hpBox");let o=pullID("hpBox");$input(o,"HP","sheetData","charHP","text","sheetHP","HP","true"),$d(a,"","armorBox");let n=pullID("armorBox");$input(n,"Armor","sheetData","charArmor","text","sheetArm","Armor","true"),$d(l,"","damBox");let r=pullID("damBox");$p(r,"Damage","labelImportant",""),$d(r,"microCon","hpDamBox");let i=pullID("hpDamBox");$input(i,"HP Damage","","hpDam","text","sheetDam","HP"),$d(r,"microCon","arDamBox");let p=pullID("arDamBox");$input(p,"Armor Damage","","arDam","text","sheetArDam","Armor"),pullID("hpDamBox").onchange=function(){update("def"),console.log("spork")},pullID("arDamBox").onchange=function(){update("def"),console.log("spork")},pullID("hpDamBox").onblur=function(){update("def"),console.log("spork")},pullID("arDamBox").onblur=function(){update("def"),console.log("spork")},$d(l,"","tpContainer");let s=pullID("tpContainer");$p(s,"TP","labelImportant","tpContainerLabel"),$d(s,"microCon","tpSubConMax");let f=pullID("tpSubConMax");$input(f,"TP Max","","tpMax","text","tpMax","Max",""),$d(s,"microCon","tpSubConCur");let D=pullID("tpSubConCur");$input(D,"TP Current","","tpCur","text","tpCurrent","Current",""),val("tpCur",3),val("tpMax",3),$d(l,"","determinationDiv");let c=pullID("determinationDiv");$input(c,"Determination","","determinCount","text","Determination","Determination"),$h(3,l,"Auxilary points: "+auxCount,"","auxCounter"),$d(t,"contentGrid","stats");let d=pullID("stats");$d(t,"contentGrid","charData");pullID("charData");$d(d,"subGrid","offenseGrid");let h=pullID("offenseGrid");$d(d,"subGrid","defenseGrid");let m=pullID("defenseGrid");$d(d,"subGrid","supportGrid");let I=pullID("supportGrid");$h(3,m,"Defense : "+defPoints,"pointCount","defPointCounter"),$h(3,h,"Offense : "+offPoints,"pointCount","offPointCounter"),$h(3,I,"Support : "+supPoints,"pointCount","supPointCounter"),$hr(t),$d(e,"","importBoxDiv");let x=pullID("importBoxDiv");$b(x,"Export",function(){exportSheet()},"imp_exp_button","exportButton"),$input(x,"","","importBox","","","Import sheet"),$b(x,"import",function(){importSheet()},"imp_exp_button","importButton"),$d(e,"","toolBox");let v=pullID("toolBox");$h(1,v,"Toolbox","","tbTitle"),$d(v,"","noteBoxDiv");let g=pullID("noteBoxDiv");$area(g,"notes","","noteBox","Notes"),$d(v,"","buffBoxDiv");let $=pullID("buffBoxDiv");$area($,"buffs","","buffBox","Buffs"),$d(v,"","debuffBoxDiv");let S=pullID("debuffBoxDiv");$area(S,"debuffs","","debuffBox","Debuffs"),$input(S,"debuffHP","","debuffHPInp","HP debuff"),$input(S,"debuffarm","","debuffARInp","Armor debuff")}function proceduralUI(e,t,l,a){for(let t=0;t<offenseList.length;t++){console.log("A tick"),$d(e,"offenseSub",offenseList[t]+"Div");let l=pullID(offenseList[t]+"Div");$p(l,offenseList[t],"statListItem",offenseList[t]+"Label"),$sel(l,"seler","selerOf"+t);let a=pullID("selerOf"+t);offSkillID.push("selerOf"+t);for(let e=0;e<=offPointMax;e++)$opt(a,e,"","");pullID("selerOf"+t).onchange=function(){update("off","selerOf"+t)},pullID("selerOf"+t).value=0}for(let e=0;e<defenseList.length;e++){console.log("B tick"),$d(t,"defenseSub",defenseList[e]+"DefDiv");let l=pullID(defenseList[e]+"DefDiv");$p(l,defenseList[e],"statListItem",defenseList[e]+"Label"),$sel(l,"seler","selerDe"+e);let a=pullID("selerDe"+e);defSkillID.push("selerDe"+e);for(let e=0;e<=defPointMax;e++)$opt(a,e,"","");pullID("selerDe"+e).onchange=function(){update("def","selerDe"+e)},pullID("selerDe"+e).value=0}for(let e=0;e<supportList.length;e++){$d(l,"supportSub",supportList[e]+"SuDiv");let t=pullID(supportList[e]+"SuDiv");$p(t,supportList[e],"statListItem",supportList[e]+"Label"),$sel(t,"seler","selerSu"+e);let a=pullID("selerSu"+e);supSkillID.push("selerSu"+e),pullID("selerSu"+e).onchange=function(){update("sup","selerSu"+e)},pullID("selerSu"+e).value=0;for(let e=0;e<=supPointMax;e++)$opt(a,e,"","")}for(let e=0;e<supportList.length;e++)pullID("selerSu"+e).value=0;generate_charData()}let charDatList=["Title","Occupation","Rank","Feature","Knowledge","Technique","Special"],ranks=["Trash Panda","Ally","Initiate","Guardian","Vigilant","Archon","Grand Archon"];function generate_charData(){let e=pullID("charData");for(let t=0;t<charDatList.length;t++){if("Feature"==charDatList[t]||"Technique"==charDatList[t]||"Special"==charDatList[t]){$d(e,"housing",charDatList[t]+"houseDiv");let l=pullID(charDatList[t]+"houseDiv");$h(3,l,charDatList[t],"housingTitle",charDatList[t]+"housingTitle");for(let e=0;e<3;e++){$d(l,"dataItem",charDatList[t]+e+"div");let a=pullID(charDatList[t]+e+"div");$area(a,"","input",charDatList[t]+e,charDatList[t]+" "+(e+1),!0),pullID(charDatList[t]+e).oninput=function(){wordCount(charDatList[t]+e,20)}}}if(charDatList[t],"Knowledge"==charDatList[t]){$d(e,"housing",charDatList[t]+"houseDiv");let l=pullID(charDatList[t]+"houseDiv");$h(3,l,charDatList[t],"housingTitle",charDatList[t]+"housingTitle");for(let e=0;e<3;e++){$d(l,"dataItemSpec",charDatList[t]+e+"div");let a=pullID(charDatList[t]+e+"div");$input(a,"",charDatList[t]+"Class",charDatList[t]+e,"",charDatList[t]+e,"","",!0)}$h(3,l,"Occupation","housingTitle","OccupationhousingTitle");for(let e=0;e<3;e++){$d(l,"dataItemSpec","Occupation"+e+"div");let t=pullID("Occupation"+e+"div");$input(t,"","OccupationClass","Occupation"+e,"","Occupation"+e,"","",!0)}}if("Rank"==charDatList[t]){$d(e,"dataItemTitle","rankDiv");let t=pullID("rankDiv");$p(t,"Rank: ","label"),$sel(t,"","rankSel");let l=pullID("rankSel");for(let e=0;e<ranks.length;e++)$opt(l,ranks[e]);l.value="Guardian"}if("Title"==charDatList[t]){$d(e,"dataItemTitle","charTitle");let t=pullID("charTitle");$input(t,"","input","Title","","","Title:")}}}function save(){let e=generateObject();try{localStorage.setItem("sheet"+localStorage.length,JSON.stringify(e)),alert("Saved successfully!")}catch{alert("Save failed! See console for error.")}}function load(e){null==e&&engine();let t=pullID("sheet");if(null==e){$sel(t,"","profileSelector");let e=pullID("profileSelector");for(let t=0;t<localStorage.length;t++){let l=JSON.parse(localStorage.getItem("sheet"+t));null!=l.name&&$opt(e,l.name,"")}e.onchange=function(){load(!0)}}let l,a=pullID("profileSelector");if(null==a)l=e;else for(let e=0;e<localStorage.length;e++){let t=JSON.parse(localStorage.getItem("sheet"+e));console.log(t),t.name==a.value&&(l=t)}loadState(l)}function loadState(e){let t=e.off,l=e.def,a=e.sup,u=(e.auxPoints,e.occupation),o=e.feature,n=e.technique,r=e.knowledge,i=e.special,p=e.hpDam,s=e.arDam,f=e.tpMax,D=e.tpCur,c=e.determination;if(val("hpDam",p),val("arDam",s),val("tpMax",f),val("tpCur",D),val("determinCount",c),null!=t){for(let e=0;e<t.length;e++)pullID("selerOf"+[e]).value=t[e];for(let e=0;e<l.length;e++)pullID("selerDe"+[e]).value=l[e];for(let e=0;e<a.length;e++)pullID("selerSu"+[e]).value=a[e];pullID("charName").value=e.name}for(let e=0;e<u.length;e++)pullID("Occupation"+e).value=u[e];for(let e=0;e<o.length;e++)pullID("Feature"+e).value=o[e][0],pullID("Feature"+e+"pre").value=o[e][1];for(let e=0;e<n.length;e++)pullID("Technique"+e).value=n[e][0],pullID("Technique"+e+"pre").value=n[e][1];for(let e=0;e<r.length;e++)pullID("Knowledge"+e).value=r[e];for(let e=0;e<i.length;e++)pullID("Special"+e).value=i[e][0],pullID("Special"+e+"pre").value=i[e][1];pullID("Title").value=e.title,pullID("rankSel").value=e.rank,update("off"),update("def"),update("sup")}function exportSheet(){let e=generateObject();alert("Success! Please copy: "+JSON.stringify(e))}function importSheet(){try{let e=pullID("importBox").value;load(JSON.parse(e)),alert("Import successful!")}catch(e){alert("Import failed! Error:"+e.message)}}function generateObject(){var e={},t=[],l=[],a=[],u=[],o=[],n=[],r=[],i=[];for(let e=0;e<offenseList.length;e++){let l=pullID("selerOf"+e).value;t.push(l)}for(let e=0;e<defenseList.length;e++){let t=pullID("selerDe"+e).value;l.push(t)}for(let e=0;e<supportList.length;e++){let t=pullID("selerSu"+[e]).value;a.push(t)}for(let e=0;e<3;e++){let t=pullID("Occupation"+e).value;u.push(t)}for(let e=0;e<3;e++){let t=[pullID("Feature"+e).value,pullID("Feature"+e+"pre").value];o.push(t)}for(let e=0;e<3;e++){let t=[pullID("Technique"+e).value,pullID("Technique"+e+"pre").value];n.push(t)}for(let e=0;e<3;e++){let t=pullID("Knowledge"+e).value;r.push(t)}for(let e=0;e<3;e++){let t=[pullID("Special"+e).value,pullID("Special"+e+"pre").value];i.push(t)}return e.name=val("charName"),e.hp=val("charHP"),e.armor=val("charArmor"),e.title=val("Title"),e.rank=val("rankSel"),e.hpDam=val("hpDam"),e.arDam=val("arDam"),e.tpMax=val("tpMax"),e.tpCur=val("tpCur"),e.determination=val("determinCount"),e.occupation=u,e.feature=o,e.technique=n,e.knowledge=r,e.special=i,e.off=t,e.def=l,e.sup=a,e.auxData=auxPoints,e}var num=0;function update(e){pullID("defPointCounter"),pullID("supPointCounter");"off"==e&&offPoints+auxPoints>0?updateAssist("off"):"def"==e&&defPoints+auxPoints>0?updateAssist("def"):"sup"==e&&supPoints+auxPoints>0&&updateAssist("sup"),updateData()}function updateData(){val("charHP",(Math.floor(val("selerDe0")/2+5)-pullID("hpDam").value).toString()),val("arDam")>0?val("charArmor",(val("selerDe2")-pullID("arDam").value).toString()):val("charArmor",val("selerDe2").toString())}let updateAssist=type=>{var typePoints=eval(type+"Points"),num=0;let data=eval(type+"SkillID");var poinTexBase=eval(type+"PointCounter");for(let e=0;e<data.length;e++){let t=parseInt(pullID(data[e]).value);"off"==type&&(t<9?(console.log("works fine"),num+=t):9==t?num=num+t+1:10==t&&(num=num+t+4)),"def"==type&&(t<9?num+=t:9==t?num=num+t+1:10==t&&(num=num+t+4)),"sup"==type&&(t<9?num+=t:9==t?num=num+t+1:10==t&&(num=num+t+4))}let pBase=eval(type+"PointsBase"),pnum=pBase-num;if(pBase-num<0){"off"==type?auxoff=Math.abs(pnum):"def"==type?auxdef=Math.abs(pnum):"sup"==type&&(auxsup=Math.abs(pnum));let e=auxoff+auxdef+auxsup,t=auxCount-(e+-Math.abs(auxDif));auxPoints=t,typePoints=0,"off"==type?poinTexBase.innerText="Offense : "+typePoints:"def"==type?poinTexBase.innerText="Defense : "+typePoints:"sup"==type&&(poinTexBase.innerText="Support : "+typePoints),pullID("auxCounter").innerText="Auxilary points: "+auxPoints}else{"off"==type?auxoff=0:"def"==type?auxdef=0:"sup"==type&&(auxsup=0),typePoints=pBase-num,"off"==type?poinTexBase.innerText=typePoints>15?"Offense : 15":"Offense : "+typePoints:"def"==type?poinTexBase.innerText=typePoints>15?"Defense : 15":"Defense : "+typePoints:"sup"==type&&(poinTexBase.innerText=typePoints>15?"Support : 15":"Support : "+typePoints);let e=auxoff+auxdef+auxsup,t=auxCount-(e+-Math.abs(auxDif));auxPoints=t,pullID("auxCounter").innerText="Auxilary points: "+auxPoints}auxPoints<0&&(pullID("auxCounter").innerText="Auxilary points: ILLEGAL  ")};function wordCount(e,t){let l=pullID(e),a=[],u=(a=l.value.split(" ")).length;if(u>t){for(;u>t;)a.pop(),u=a.length;let e="";for(let t=0;t<u;t++)e+=a[t]+" ";return l.value=e,!0}return!1}